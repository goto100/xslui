<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>无标题文档</title>
<style type="text/css">
body {
	margin: 0;
	padding: 0;
	height: 100%;
}
div.overlay {
	background-color: #999999;
	filter:alpha(opacity=80);
	opacity: 0.8;
}
div.window {
	width: 300px;
	height: 200px;
	border: 1px solid #000;
}
</style>
<script type="text/javascript" src="src/base2-dom-fp.js"></script>
<script type="text/javascript">
base2.JavaScript.bind(window);
base2.DOM.bind(document);
base2.DOM.EventTarget(window);

base2.DOM.HTMLElement.prototype.fix = function(dynamics) {
	if (document.all) this.style.position = "absolute";
	else this.style.position = "fixed";
	this.style.top = (document.documentElement.scrollTop + ((document.documentElement.clientHeight || document.body.clientHeight) - this.offsetHeight) / 2) + "px";
	this.style.left = (document.documentElement.scrollLeft + (document.documentElement.clientWidth - this.offsetWidth) / 2) + "px";

	if (dynamics) {
		var node = this;
		window.addEventListener("resize", function() {
			node.fix();
		}, false);
		if (document.all) {
			window.attachEvent("onresize", function() {
				node.fix();
			}, false);
			window.attachEvent("onscroll", function() {
				node.fix();
			}, false);
		}
	}
}

function Window() {
	this.modal = false;
}

Window.bind = function(node) {
	node.modal = node.className.split(" ").contains("modal");
	node.show = Window.prototype.show;
}

Window.prototype.show = function() {
	this.style.display = "";
	this.style.zIndex = 2;
	this.fix(true);
	if (this.modal) {
		var overlay = document.createElement("div");
		overlay.className = "overlay";
		overlay.fix(true);
		overlay.style.top = "0px";
		overlay.style.left = "0px";
		overlay.style.zIndex = this.style.zIndex - 1;;
		overlay.style.width = "100%";
		overlay.style.height = "100%";
		this.parentNode.appendChild(overlay);
	}
}

document.addEventListener("DOMContentLoaded", function() {
	document.querySelectorAll("div.window").forEach(function(win) {
		win.style.display = "none";
		Window.bind(win);
	});

	document.querySelectorAll("div.window").invoke("show");
}, false);



</script>
</head>

<body>
<div class="modal window">
	<h2>Modal Window</h2>
	<p>content</p>
</div>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
</body>
</html>
